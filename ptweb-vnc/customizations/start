#!/bin/bash

# If a runtime installer exists, run it as root to install Packet Tracer from
# any .deb placed into the container (or mounted) at startup. This defers
# installation from the image build to runtime and makes newer PacketTracer
# versions (different filenames) transparent.
# NOTE: We run this in the background and do NOT block on failure.
# VNC/XFCE will start regardless, allowing manual PacketTracer launch later.
if [ -x /runtime-install.sh ]; then
	echo "Running runtime installer check..."
	/runtime-install.sh &>/tmp/runtime-install.log &
	# Don't wait for it; VNC/XFCE will start immediately
fi

# disable DNS resolution for PT auth
#echo > /etc/resolv.conf

# Use runuser instead of su for better container compatibility
# runuser doesn't require PAM and is lighter weight than su
if command -v runuser >/dev/null 2>&1; then
    exec runuser -u ptuser /start-session
else
    # Fallback to su if runuser not available
    exec su -s /bin/sh -l ptuser -c /start-session
fi
